# 简述：

EasyMVS是一个sfm+mvs三维重建框架，为了学习三维重建流程而生，希望使用现有的组件来快速简洁的实现三维重建任务。该框架是一个静态物体重建框架，没有考虑动态物体重建的问题。

# 任务：

使用双目相机，RGBD相机(结构光相机/纹理双目相机)，单目相机，结合外部数据(里程计/机械臂/先验信息等)来完成三维重建任务，最终生成点云。

# 特性：

支持双目相机，RGBD相机，单目相机

模块化设计，支持文件形式保存中间结果

支持外部输入的位姿数据

# 依赖：

OpenCV 4.5.5 图像处理

PCL 1.12 3D点云处理

Ceres  非线性优化

dbow2 词袋模型

Eigen3 矩阵计算

Sophus 李群与李代数

qt 5.15 数据框架

nlohmann-json 数据读写支持

# 模块功能：

## 相机初始化：

导入内参

导入

初始化传感器/初始化文件系统

### 输入：

文件地址/传感器设备ID

### 输出：

无

### 信号：

设备开启成功/开启失败

### 说明：

将多目相机建模为多个单目相机构成的相机组，这样方便将单目模型和双目模型统一

这里的相机需要区分从相机和主相机，区分可匹配特征点相机和不可匹配特征点相机

## 加载图片：

主要功能为拍摄图片

双目相机：拍摄图片(同步曝光，打光)并去畸变

RGBD相机：拍摄多张照片，并得到深度图，去畸变

单目相机/图片：拍摄图片/读取图片

### 输入：

文件/相机/投影仪

### 输出：

去畸变图片/深度图/拍摄时间戳

### 信号：

一帧拍摄完成信号

### 说明：

双目相机同步触发，RGBD相机需要拍摄多组图片，并在这里的输出得到深度图和RGB图(该流程内部可再细分线程实现流水线)。

## 特征提取：

提取图像特征

SURF/SIFT/ORB特征

自定义mark点

### 输入：

待匹配的图片

匹配参数

### 输出：

特征点集

### 说明：

可以使用OpenCV的特征描述子来处理，注意同意自己的mark点描述子和OpenCV的描述子

注意处理找不到特征点的情况

## 特征匹配：

匹配图像特征

### 输入：

特征点集，码书(可选)(词袋模型可能需要)

### 输出：

特征向量/匹配结果(成功匹配的结果/没匹配的结果)

码书(为后续回环检测等使用)

### 说明：

匹配方式包括暴力匹配，预选相机对+词袋树，顺序匹配

## 姿态恢复：

根据特征点匹配关系恢复姿态，

根据预设相机位置(双目外参)恢复姿态

根据外部输入恢复位姿(高精度机械臂)

根据外部输入和图像关系恢复姿态(小车/低精度机械臂/VIO)

### 输入：

特征点匹配结果

先验姿态信息

预设相机对

### 输出：

姿态

### 说明：

这里应该搞一个小地图类

寻找初始相机对->计算初始稀疏3D点->选择下一个相机(顺序输入/最优匹配)->pnp并计算相对姿态->根据匹配情况计算新稀疏3D点->局部BA优化(与运动方程融合)

## 回环检测/姿态优化：

根据特征点和预设词典(可选)计算回环

进行闭环优化/图优化/BA优化

### 输入：

特征点集/姿态

### 输出：

姿态

### 说明：

这里搞一个大地图类

(全局优化怎么搞待定)

## 稠密建图：

产生稠密点云，使用SGM，SSD，SAD等方法或自研方法

双目相机：双目稠密重建

结构光相机：直接输出稠密结果/输出滤波后结果

单目相机：选择合适相机对，并双目稠密重建

### 输入：

特征点/特征点匹配/相机姿态/最优相机对(可选)

图片对/深度图

### 输出：

深度图/点云

### 说明：

匹配最优相机对->双目/多目视觉产生深度图(使用深度图而非点云方便后续融合)

稠密匹配算法可以使用现有算法或者使用自研算法

## 全局优化：

多片点云拼接融合

ICP/SDF/TSDF/泊松采样/NeRF(ML)

### 输入：

深度图/点云

姿态

### 输出：

滤波后点云/体素/八叉树/隐式表达

### 说明：

如果使用NeRF的话可以跳过稠密建图部分

## 点云处理：

滤波

### 输入：

### 输出：

### 信号：
